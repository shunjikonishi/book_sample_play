"undefined"==typeof room&&(room={}),"undefined"==typeof room.utils&&(room.utils={}),$(function(){"use strict";function a(){return!document[e]}function b(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function c(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}var d=function(){var a="hidden",b=["webkit","moz","ms"];if(a in document)return"";a="Hidden";for(var c=0;c<b.length;c++)if(b+a in document)return b;return""}(),e=d?d+"Hidden":"hidden",f=d+"visibilitychange",g={log:function(){}},h={maxRetry:5,authCommand:"room.auth",authError:null,retryInterval:1e3,noopCommand:"noop",logger:g};c()&&(f="pageshow"),room.Connection=function(c){function d(a){if(t.log("request",a),!p())return void((z||A<c.maxRetry)&&(n(function(){d(a)}),z||(C=q())));c.onRequest&&c.onRequest(a.command,a.data);var b=(new Date).getTime(),e=++u;v[e]=b,a.success&&(w[e]=a.success),a.error&&(x[e]=a.error);var f={id:e,command:a.command,data:a.data};return a.log&&(f.log=a.log),C.send(JSON.stringify(f)),s}function e(a,b,c){return b&&(w[a]=b),c&&(x[a]=c),s}function g(a){return delete w[a],delete x[a],s}function i(a){function b(a){t.log("authError",c.url),A=c.maxRetry,c.authError&&c.authError(a)}z=!1,t.log("onOpen",c.url),c.onOpen&&c.onOpen(a),A=0,c.authToken&&d({command:c.authCommand,data:c.authToken,success:function(a){c.authToken=a},error:b});for(var e=0;e<y.length;e++)y[e]();y=[]}function j(a){t.log("receive",a.data),c.onMessage&&c.onMessage(a);var b=JSON.parse(a.data),d=v[b.id],e=null;d&&delete v[b.id],"error"==b.type?b.id&&x[b.id]?e=x[b.id]:b.command&&x[b.command]?e=x[b.command]:c.onServerError&&(e=c.onServerError):b.id&&w[b.id]?e=w[b.id]:b.command&&w[b.command]&&(e=w[b.command]),b.id&&(delete w[b.id],delete x[b.id]),e?e(b.data):"error"!=b.type&&t.log("UnknownMessage",a.data)}function k(d){function e(){return b()&&!a()?!1:A<c.maxRetry}t.log("close",c.url),c.onClose&&c.onClose(d),e()?(setTimeout(function(){p()||(C=q())},A*c.retryInterval),A++):B&&(clearInterval(B),B=0)}function l(a){c.onSocketError&&c.onSocketError(a)}function m(a,b){return setInterval(function(){p()&&d($.extend(!0,{},b))},a)}function n(a){p()?a():y.push(a)}function o(){p()&&(A=c.maxRetry,C.close())}function p(){return 1==C.readyState}function q(){z=!0;var a=new WebSocket(c.url);return a.onopen=i,a.onmessage=j,a.onerror=l,a.onclose=k,a}function r(b,c,e){return B&&clearInterval(B),B=setInterval(function(){p()&&(c||a())&&d({command:e||"noop"})},1e3*b)}"string"==typeof c&&(c={url:c}),c=$.extend({},h,c);var s=this,t=c.logger,u=0,v={},w={},x={},y=[],z=!1,A=0,B=0,C=q();$(window).on("beforeunload",o),$(document).on(f,function(){var b=a();t.log(f,"visible="+b),b&&!p()&&(C=q())}),c.noopCommand&&e(c.noopCommand,function(){}),$.extend(this,{request:d,addEventListener:e,removeEventListener:g,on:e,off:g,polling:m,ready:n,close:o,isConnected:p,sendNoop:r,onOpen:function(a){return c.onOpen=a,this},onClose:function(a){return c.onClose=a,this},onRequest:function(a){return c.onRequest=a,this},onMessage:function(a){return c.onMessage=a,this},onSocketError:function(a){return c.onSocketError=a,this},onServerError:function(a){return c.onServerError=a,this}})},$.extend(room.utils,{isIOS:c,isMobile:b,isDocumentVisible:a})}),"undefined"==typeof room&&(room={}),$(function(){room.Cache=function(a,b){function c(c){if(a)try{return a.getItem(c)}catch(d){b&&console&&console.log(d)}return null}function d(a){var b=c(a);return b&&(b=JSON.parse(b)),b}function e(c,d){if(a){"object"==typeof d&&(d=JSON.stringify(d));try{a.setItem(c,d)}catch(e){b&&console&&console.log(e)}}}function f(c){if(a)try{a.removeItem(c)}catch(d){b&&console&&console.log(d)}}function g(){var c=[];if(a)try{for(var d=0;d<a.length;d++)c.push(a.key(d))}catch(e){b&&console&&console.log(e)}return c}function h(){try{return sotrage?a.length:0}catch(c){b&&console&&console.log(c)}}function i(){if(a)try{a.clear()}catch(c){b&&console&&console.log(c)}}$.extend(this,{get:c,getAsJson:d,put:e,remove:f,size:h,clear:i,keys:g})}}),"undefined"==typeof room&&(room={}),$(function(){room.Cache&&(room.TemplateManager=function(a,b){function c(c,e,f){function g(a){c.html(a).show(),f&&f(a)}var h=a.get("template."+e);return h?void g(h):void b(e,function(a){d(e,a),g(a)})}function d(b,c){a.put("template."+b,c)}$.extend(this,{load:c,save:d})})}),"undefined"==typeof room&&(room={}),"undefined"==typeof room.logger&&(room.logger={}),"undefined"==typeof room.utils&&(room.utils={}),$(function(){function a(b){var c=typeof b;if("object"!==c)return b;if($.isArray(b)){for(var d=[],e=0;e<b.length;e++)c=typeof b[e],d.push("function"===c?"(function)":"object"===c?a(b[e]):b[e]);return d}var f={};for(var g in b)c=typeof g,f[g]="function"===c?"(function)":"object"===c?a(b[g]):b[g];return f}room.logger.WsLogger=function(b,c){var d=new room.Connection(b);c=c||"log",this.log=function(){d.request({command:c,data:a(arguments)})}},room.logger.DivLogger=function(b){this.log=function(){for(var c=[],d=0;d<arguments.length;d++)c.push("object"==typeof arguments[d]?a(arguments[d]):arguments[d]);$("<p/>").text(JSON.stringify(c)).prependTo(b)}},room.logger.nullLogger={log:function(){}},$.extend(room.utils,{stripFunc:a})});